<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Projects - Otra Ciudad</title>
    <link rel="stylesheet" href="https://use.typekit.net/zhl8vxt.css">
    <link rel="stylesheet" href="css/style.css" />
</head>

<body class="page-projects">
    <header class="topbar">
        <div class="topbar__inner">
            <a class="brand" href="index.html" aria-label="Ir al inicio">
                <picture>
                    <source media="(min-width: 521px)" srcset="assets/uploads/otraCiudad_03.png" />
                    <img class="brand__logo" src="assets/uploads/otraCiudad_01.png" alt="Otra Ciudad" />
                </picture>
            </a>

            <nav class="topnav" aria-label="Navegación principal">
                <a href="about.html">About us</a>
                <a href="projects.html">Projects</a>
                <a href="contact.html">Contact us</a>
            </nav>

            <button class="menuBtn" type="button" aria-label="Abrir menú" aria-expanded="false">
                <span class="menuBtn__bar" aria-hidden="true"></span>
                <span class="menuBtn__bar" aria-hidden="true"></span>
                <span class="menuBtn__bar" aria-hidden="true"></span>
            </button>
        </div>
    </header>

    <main class="projects">
        <div class="projects__container">
            <div id="projectsList" class="projects__list">
                </div>
        </div>
    </main>

    <script>
        (function () {
            const btn = document.querySelector(".menuBtn");
            const nav = document.querySelector(".topnav");
            if (!btn || !nav) return;

            function closeMenu() {
                document.body.classList.remove("menu-open");
                btn.setAttribute("aria-expanded", "false");
            }

            btn.addEventListener("click", () => {
                const open = !document.body.classList.contains("menu-open");
                document.body.classList.toggle("menu-open", open);
                btn.setAttribute("aria-expanded", String(open));
            });

            nav.addEventListener("click", (e) => {
                if (e.target && e.target.tagName === "A") closeMenu();
            });

            window.addEventListener("keydown", (e) => {
                if (e.key === "Escape") closeMenu();
            });
        })();
    </script>

    <script>
        (function () {
            const basePath = window.location.pathname.includes('/otraCiudadWeb/') 
                ? '/otraCiudadWeb' 
                : '';

            const projectsList = document.getElementById('projectsList');
            projectsList.innerHTML = '<p style="padding: 40px; text-align: center; color: #999;">Cargando proyectos...</p>';

            // Llamamos al índice generado por el script de build
            fetch(`${basePath}/content/projects-index.json`)
                .then(res => {
                    if (!res.ok) throw new Error('Índice no encontrado');
                    return res.json();
                })
                .then(data => {
                    // Accedemos a la propiedad .projects del JSON
                    const projects = data.projects || [];
                    
                    if (projects.length === 0) {
                        projectsList.innerHTML = `
                            <div style="padding: 80px 20px; text-align: center;">
                                <h2 style="font-family: var(--font-title); font-size: 48px; margin: 0 0 20px; font-weight: 800; line-height: 1;">No hay proyectos aún</h2>
                                <p style="font-size: 18px; color: #666; margin: 0;">Los proyectos aparecerán aquí cuando los crees desde el CMS.</p>
                            </div>
                        `;
                        return;
                    }

                    // Renderizado de tarjetas
                    projectsList.innerHTML = projects.map(project => `
                        <a href="project.html?project=${project.slug}" class="projectCard">
                            <div class="projectCard__imgWrap">
                                <img class="projectCard__img" 
                                     src="${basePath}/${project.coverImage}" 
                                     alt="${project.title}" />
                            </div>
                            <h2 class="projectCard__title">${project.title}</h2>
                            <div class="projectCard__meta">
                                <span class="projectCard__label">Location:</span>
                                <span class="projectCard__location">${project.location || ''}</span>
                            </div>
                            <div class="projectCard__meta">
                                <span class="projectCard__label">Year:</span>
                                <span class="projectCard__year">${project.year || ''}</span>
                            </div>
                        </a>
                    `).join('');
                })
                .catch(err => {
                    console.error('Error:', err);
                    projectsList.innerHTML = `
                        <div style="padding: 80px 20px; text-align: center;">
                            <h2 style="font-family: var(--font-title); font-size: 32px; margin: 0 0 20px; font-weight: 800;">Configurando el índice...</h2>
                            <p style="font-size: 18px; color: #666;">Si acabas de subir cambios, espera a que Netlify termine el despliegue.</p>
                        </div>
                    `;
                });
        })();
    </script>

    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</body>
</html>